---
title: "tomcat 삽질"
layout: post
---

회사에서는 주로 intellij를 사용하고 있는데 새로오신 분이 이클립스를 고군분투하며 설치하고 계셨다.

나도 ~~주제도 모르고~~ 조금이라도 도움을 드리고 싶은 마음에 eclipse를 설치해보고 알려드리려고 했다.

결과 이클립스로 서버 띄우는건 고사하고 잘만 사용하고 있던 인텔리제이만 망가져서 엉망진창이 되버림;

이클립스 환경설정이 기존 것을 꼬이게 만든 것인지, 아님 프로젝트 중 큰 변화가 있어

1.8대였던 jdk를 11 버전으로 변경하면서 꼬인 것인지 너무 사태가 복잡했음;

자바까지 삭제했다 다시 설치하고, 그 와중에 인텔리제이 Ultimate 인증까지 풀려서 내부망 환경에서 핫스팟으로 변경하느라 애먹고

가지가지 했다 정말. 그래도 짜증내기보단 하다보면 공부될거고 나아질거라는 신념을 갖고 열심히 임했다.



## AJP

일단 부랴부랴 intellij에서 서버 띄우려고 하는데 맨 처음 오류메시지가 AJP 설정을 server.xml에 추가하라는 거였다.

AJP가 뭔가 하니, 정적 파일에 대한 요청과 동적 콘텐츠에 대한 요청을 각각 분리할 수 있는데

앞단에서 정적 파일에 대한 응답을 위한 웹 서버(나의 경우 Apache)와 뒷단에서 동적 파일에 대한 응답을 하는 WAS(Web Application Server)(나의 경우 Tomcat)가 

서로 통신할 수 있게 하는 프로토콜(Apache Jserve Protocol)이다. 

이건 이클립스를 설치하며 새로 받았던(~~미쳤나?~~) tomcat 8.5에서 잘 해결이 안되어서 tomcat 8.0으로 다운그레이드했더니 이 문제는 해결되었다.


## JKS

이제 될까 싶었는데 또 서버에서 에러메시지를 꾸역꾸역 뱉어내시는데 대충봤지만 keystore 어쩌구 에러였다.

퇴근 직전이었어서 문제해결은 못하고 왔는데, https랑 관련되어 인증키같은 부분이 문제인가보다.

이름이 Java Key Store인거보니, 불현듯 떠오르는게 있었다;

이클립스 설치를 하며 자바 버전도 바꾸고 환경변수 셋팅도 그에 맞게 싹다 변경했기 때문이다.

그 와중에 뭔가 path를 못찾는 문제가 발생한건 아닌지... 내일 추가적으로 확인해봐야겠다.


## 후기

org.apache.tomcat.util.net.jsse.JSSESocketFactory.getStore Failed to load keystore type JKS with path C:\Users\user/.keystore due to Illegal character in opaque

-> .keystore 파일이 C:\Users에 설치되어있는데 탐캣은 C:\Users\user 경로에서 찾고는 없다고 함;;; 그냥 .keystore 파일을 탐캣이 찾는 경로에 복붙해서 해결

Unable to process Jar entry [] from Jar [] for annotations

-> jar를 탐캣이 못찾겠다는 에러... jar버전을 낮추면 된다는 블로그가 대다수였지만 그걸로 해결하기엔 안되는 jar파일이 너무 많았다.

결국 문제는 내가 eclipse깔면서 Tomcat을 새로 받았던게 문제였다......;;; Tomcat 8.0.x : 8.0.42 이하 버전을 사용하고 있었고 해당 버전은 Tomcat 버그 해결이 안된 버전이었던 것임.

[이 블로그](https://avaiable.tistory.com/261) 참조하여 버전 맞추고 Http11NioProtocol > SSLHostConfig > certificateKeystoreFile 경로까지 모두 셋팅하고나니 작동했다.

진짜 멀쩡하게 일하고 있다가 혼자 이유도 없이 작업환경 엉망진창 만들어버렸는데 의외로 Tomcat 작동원리 및 SSL 관련 좋은 공부가 됐다.

[SSL 관련 이해하기 좋은 블로그](https://shxrecord.tistory.com/168)


<font color='#909194'>Last updated: January 07, 2022</font>